# user-management Specification

## Purpose
TBD - created by archiving change add-user-management-api. Update Purpose after archive.
## Requirements
### Requirement: 用户列表查询

系统 SHALL 提供用户列表查询功能，支持分页、多维度筛选和搜索。

#### Scenario: 分页查询用户列表

- **WHEN** 管理员请求用户列表（page=1, pageSize=20）
- **THEN** 返回第一页的 20 条用户记录
- **AND** 返回总记录数和总页数

#### Scenario: 按用户状态筛选

- **WHEN** 管理员筛选冻结状态的用户
- **THEN** 返回所有状态为"冻结"的用户列表

#### Scenario: 按会员类型筛选

- **WHEN** 管理员筛选 PLUS 会员
- **THEN** 返回所有会员类型为"PLUS 会员"的用户列表

#### Scenario: 按注册时间筛选

- **WHEN** 管理员筛选本周注册的用户
- **THEN** 返回本周注册的所有用户列表

#### Scenario: 搜索用户

- **WHEN** 管理员输入手机号或昵称搜索
- **THEN** 返回匹配的用户列表
- **AND** 手机号支持模糊搜索

---

### Requirement: 用户详情查询

系统 SHALL 提供用户详情查询功能，返回用户的完整信息。

#### Scenario: 查询用户详情成功

- **WHEN** 管理员请求查询用户详情（提供有效的用户 ID）
- **THEN** 返回该用户的完整信息
- **AND** 包括基本信息、认证信息、标签、审核记录

#### Scenario: 查询不存在的用户

- **WHEN** 管理员请求查询不存在的用户 ID
- **THEN** 返回错误：用户不存在

---

### Requirement: 用户信息更新

系统 SHALL 允许管理员更新用户的基本信息。

#### Scenario: 更新用户昵称成功

- **WHEN** 运营管理员更新用户昵称
- **THEN** 用户昵称更新成功
- **AND** 记录操作日志

#### Scenario: 普通管理员无权限更新

- **WHEN** 普通管理员尝试更新用户信息
- **THEN** 返回错误：权限不足

#### Scenario: 超级管理员可更新所有信息

- **WHEN** 超级管理员更新用户的任何信息
- **THEN** 更新成功
- **AND** 记录操作日志

---

### Requirement: 用户状态管理

系统 SHALL 提供用户状态管理功能，允许管理员冻结、封禁或恢复用户账户。

#### Scenario: 冻结用户账户

- **WHEN** 管理员冻结用户账户（提供冻结原因）
- **THEN** 用户状态更新为"冻结"
- **AND** 用户无法登录
- **AND** 记录操作日志和原因

#### Scenario: 封禁用户账户

- **WHEN** 管理员封禁用户账户（提供封禁原因）
- **THEN** 用户状态更新为"封禁"
- **AND** 用户无法登录
- **AND** 所有正在进行的订单被取消
- **AND** 记录操作日志和原因

#### Scenario: 恢复正常状态

- **WHEN** 管理员恢复被冻结或封禁的用户账户
- **THEN** 用户状态更新为"正常"
- **AND** 用户可以正常登录
- **AND** 记录操作日志

#### Scenario: 状态转换不合法

- **WHEN** 管理员尝试将正常用户直接设置为正常
- **THEN** 返回错误：状态无变化

---

### Requirement: 实名资料审核

系统 SHALL 提供实名资料审核功能，允许管理员审核用户提交的实名认证资料。

#### Scenario: 审核通过实名资料

- **WHEN** 管理员审核实名资料并选择通过
- **THEN** 用户实名认证状态更新为"已通过"
- **AND** 记录审核日志（审核人、审核时间、审核结果）

#### Scenario: 审核拒绝实名资料

- **WHEN** 管理员审核实名资料并选择拒绝（提供拒绝原因）
- **THEN** 用户实名认证状态更新为"已拒绝"
- **AND** 记录拒绝原因
- **AND** 用户可以重新提交资料

#### Scenario: 审核未提交的资料

- **WHEN** 管理员尝试审核状态为"未提交"的实名资料
- **THEN** 返回错误：用户未提交实名资料

#### Scenario: 重复审核已通过的资料

- **WHEN** 管理员尝试审核状态为"已通过"的实名资料
- **THEN** 返回错误：该资料已审核通过

---

### Requirement: 驾照资料审核

系统 SHALL 提供驾照资料审核功能，允许管理员审核用户提交的驾照认证资料。

#### Scenario: 审核通过驾照资料

- **WHEN** 管理员审核驾照资料并选择通过
- **THEN** 用户驾照认证状态更新为"已通过"
- **AND** 记录审核日志（审核人、审核时间、审核结果）

#### Scenario: 审核拒绝驾照资料

- **WHEN** 管理员审核驾照资料并选择拒绝（提供拒绝原因）
- **THEN** 用户驾照认证状态更新为"已拒绝"
- **AND** 记录拒绝原因
- **AND** 用户可以重新提交资料

#### Scenario: 用户未完成实名认证

- **WHEN** 管理员尝试审核驾照资料，但用户实名认证未通过
- **THEN** 返回错误：请先完成实名认证

---

### Requirement: 用户标签管理

系统 SHALL 提供用户标签管理功能，允许管理员为用户添加、删除标签。

#### Scenario: 添加单个标签

- **WHEN** 管理员为用户添加标签（如"高频租车"）
- **THEN** 标签添加成功
- **AND** 标签出现在用户的标签列表中

#### Scenario: 添加重复标签

- **WHEN** 管理员为用户添加已存在的标签
- **THEN** 返回提示：标签已存在，无需重复添加

#### Scenario: 删除用户标签

- **WHEN** 管理员删除用户的某个标签
- **THEN** 标签删除成功
- **AND** 标签从用户的标签列表中移除

#### Scenario: 批量添加标签

- **WHEN** 管理员批量为多个用户添加标签
- **THEN** 所有用户的标签添加成功
- **AND** 返回成功添加的用户数量

#### Scenario: 查询用户标签列表

- **WHEN** 管理员查询用户的所有标签
- **THEN** 返回用户的标签列表（包括系统标签和自定义标签）

---

### Requirement: 用户数据导出

系统 SHALL 提供用户数据导出功能，允许管理员导出用户列表数据。

#### Scenario: 导出筛选后的用户数据

- **WHEN** 管理员筛选用户列表并点击导出
- **THEN** 生成 Excel 文件包含筛选后的用户数据
- **AND** 文件包含用户 ID、手机号、昵称、会员类型、注册时间、状态等字段

#### Scenario: 导出全部用户数据

- **WHEN** 管理员不设置筛选条件，直接导出
- **THEN** 生成 Excel 文件包含所有用户数据

#### Scenario: 导出数据脱敏

- **WHEN** 导出用户数据
- **THEN** 手机号自动脱敏显示（如 138\*\*\*\*8888）
- **AND** 身份证号自动脱敏显示（如 110101**\*\*\*\***1234）

---

### Requirement: 权限控制

系统 SHALL 实施严格的权限控制，不同角色拥有不同的操作权限。

#### Scenario: 普通管理员只读权限

- **WHEN** 普通管理员访问用户列表或详情
- **THEN** 可以查看用户信息
- **AND** 无法编辑用户信息或审核资料

#### Scenario: 运营管理员编辑权限

- **WHEN** 运营管理员编辑用户基本信息
- **THEN** 编辑成功
- **AND** 记录操作日志

#### Scenario: 超级管理员全部权限

- **WHEN** 超级管理员执行任何用户管理操作
- **THEN** 操作成功
- **AND** 记录操作日志

#### Scenario: 未授权访问

- **WHEN** 未登录或非管理员用户访问管理接口
- **THEN** 返回错误：未授权访问


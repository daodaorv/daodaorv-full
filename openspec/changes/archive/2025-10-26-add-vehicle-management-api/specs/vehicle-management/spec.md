# Spec: 车辆管理 API

## ADDED Requirements

### Requirement: 车型模板管理

系统 SHALL 提供车型模板管理功能，允许管理员创建、查询、更新和删除车型模板。

#### Scenario: 创建车型模板成功

- **WHEN** 管理员提供有效的车型模板信息（名称、品牌、类型、年份、所有权类型等）
- **THEN** 系统创建车型模板并返回模板信息

#### Scenario: 查询车型模板列表

- **WHEN** 管理员请求车型模板列表
- **THEN** 系统返回分页的车型模板列表，支持按品牌、类型筛选

#### Scenario: 更新车型模板

- **WHEN** 管理员更新车型模板信息
- **THEN** 系统更新车型模板并返回更新后的信息

#### Scenario: 删除车型模板

- **WHEN** 管理员删除车型模板
- **THEN** 系统删除车型模板（如果没有关联车辆）

### Requirement: 车辆信息管理

系统 SHALL 提供车辆信息管理功能，允许管理员创建、查询、更新和删除车辆。

#### Scenario: 创建车辆成功

- **WHEN** 管理员提供有效的车辆信息（车牌号、车型模板、门店、状态等）
- **THEN** 系统创建车辆并返回车辆信息

#### Scenario: 查询车辆列表

- **WHEN** 管理员请求车辆列表
- **THEN** 系统返回分页的车辆列表，支持按状态、门店、车型筛选

#### Scenario: 更新车辆信息

- **WHEN** 管理员更新车辆信息
- **THEN** 系统更新车辆并返回更新后的信息

#### Scenario: 删除车辆

- **WHEN** 管理员删除车辆
- **THEN** 系统软删除车辆并删除关联的维护记录和调度记录

### Requirement: 车辆状态管理

系统 SHALL 提供车辆状态管理功能，允许管理员更新车辆状态。

#### Scenario: 更新车辆状态成功

- **WHEN** 管理员更新车辆状态（可用、租赁中、维护中、停用）
- **THEN** 系统更新车辆状态并返回更新后的信息

#### Scenario: 状态转换验证

- **WHEN** 管理员尝试非法的状态转换
- **THEN** 系统返回 400 错误，说明状态转换不合法

### Requirement: 车辆维护记录管理

系统 SHALL 提供车辆维护记录管理功能，允许管理员创建、查询和更新维护记录。

#### Scenario: 创建维护记录成功

- **WHEN** 管理员提供有效的维护记录信息（车辆 ID、维护类型、费用、描述等）
- **THEN** 系统创建维护记录并返回记录信息

#### Scenario: 查询维护记录列表

- **WHEN** 管理员请求某车辆的维护记录列表
- **THEN** 系统返回该车辆的所有维护记录

#### Scenario: 更新维护记录

- **WHEN** 管理员更新维护记录信息
- **THEN** 系统更新维护记录并返回更新后的信息

### Requirement: 车辆调度记录管理

系统 SHALL 提供车辆调度记录管理功能，允许管理员创建和查询调度记录。

#### Scenario: 创建调度记录成功

- **WHEN** 管理员提供有效的调度记录信息（车辆 ID、源门店、目标门店、调度原因等）
- **THEN** 系统创建调度记录并返回记录信息

#### Scenario: 查询调度记录列表

- **WHEN** 管理员请求某车辆的调度记录列表
- **THEN** 系统返回该车辆的所有调度记录

### Requirement: 权限控制

系统 SHALL 确保只有管理员可以访问车辆管理 API。

#### Scenario: 管理员访问成功

- **WHEN** 已认证的管理员访问车辆管理 API
- **THEN** 系统允许访问并返回相应数据

#### Scenario: 非管理员访问被拒绝

- **WHEN** 非管理员用户尝试访问车辆管理 API
- **THEN** 系统返回 403 错误，拒绝访问

### Requirement: 数据验证

系统 SHALL 验证所有输入数据的有效性。

#### Scenario: 车牌号格式验证

- **WHEN** 管理员提供无效的车牌号格式
- **THEN** 系统返回 400 错误，说明车牌号格式不正确

#### Scenario: 必填字段验证

- **WHEN** 管理员创建车辆时缺少必填字段
- **THEN** 系统返回 400 错误，说明缺少必填字段

### Requirement: 测试覆盖

系统 SHALL 为所有车辆管理 API 提供完整的测试覆盖。

#### Scenario: 单元测试通过

- **WHEN** 运行车辆管理 API 的单元测试
- **THEN** 所有测试用例通过（100% 通过率）

#### Scenario: 集成测试通过

- **WHEN** 运行车辆管理 API 的集成测试
- **THEN** 所有测试用例通过，包括数据库操作和 API 调用

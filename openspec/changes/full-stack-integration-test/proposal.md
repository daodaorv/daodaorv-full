# 全端联通联调测试

## 概述

实现后端、C端小程序、PC管理端、移动管理端的基础功能,并完成全端联通联调测试,验证整个系统的端到端通信能力。

## 目标

1. 实现后端基础 API 接口 (用户认证、数据查询)
2. 实现 C 端小程序与后端的数据交互
3. 实现 PC 管理端与后端的数据交互
4. 实现移动管理端与后端的数据交互
5. 验证所有端的联通性和数据一致性
6. 建立端到端的测试流程

## 动机

在开始实际业务功能开发之前,需要确保:
- 所有端都能正常启动和运行
- 所有端都能成功连接后端 API
- 数据能在各端之间正确传递
- 跨域、认证、数据格式等基础问题已解决

这将为后续的业务功能开发提供可靠的技术基础。

## 详细设计

### 1. 后端基础 API 实现

#### 1.1 用户认证 API
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/register` - 用户注册
- `GET /api/auth/profile` - 获取用户信息
- `POST /api/auth/logout` - 用户登出

#### 1.2 测试数据 API
- `GET /api/test/ping` - 连通性测试
- `GET /api/test/echo` - 回显测试
- `GET /api/test/vehicles` - 获取车辆列表 (测试数据)
- `GET /api/test/vehicles/:id` - 获取车辆详情 (测试数据)

#### 1.3 数据库集成
- 配置 TypeORM 实体
- 实现 User 实体和 Repository
- 实现 Vehicle 实体和 Repository
- 实现基础的 CRUD 操作

#### 1.4 中间件完善
- JWT 认证中间件
- CORS 跨域配置
- 请求参数验证中间件
- 响应格式统一中间件

### 2. C 端小程序集成

#### 2.1 API 请求封装
- 创建 `src/utils/request.ts` 统一请求工具
- 配置 API 基础 URL
- 实现请求拦截器 (添加 token)
- 实现响应拦截器 (错误处理)

#### 2.2 测试页面
- 创建 API 测试页面 (`pages/test/index.vue`)
- 实现连通性测试按钮
- 实现登录测试功能
- 实现数据获取测试功能
- 显示请求结果和响应时间

#### 2.3 状态管理
- 创建 user store (Pinia)
- 实现登录状态管理
- 实现 token 持久化

### 3. PC 管理端集成

#### 3.1 API 请求封装
- 创建 `src/api/request.ts` 统一请求工具
- 配置 Axios 实例
- 实现请求拦截器
- 实现响应拦截器

#### 3.2 测试页面
- 创建系统测试页面 (`views/system/test.vue`)
- 实现 API 连通性测试
- 实现登录功能测试
- 实现数据列表展示
- 添加到路由和菜单

#### 3.3 状态管理
- 创建 user store (Pinia)
- 实现登录状态管理
- 实现权限管理

### 4. 移动管理端集成

#### 4.1 API 请求封装
- 创建 `src/utils/request.ts` 统一请求工具
- 配置 API 基础 URL
- 实现请求/响应拦截器

#### 4.2 测试页面
- 创建系统测试页面 (`pages/test/index.vue`)
- 实现 API 测试功能
- 实现登录测试
- 显示测试结果

### 5. 联调测试方案

#### 5.1 测试环境准备
- 确保 Docker 容器运行 (MySQL, Redis)
- 启动后端服务 (localhost:3000)
- 准备测试数据

#### 5.2 测试用例
1. **连通性测试**
   - 各端调用 `/api/test/ping` 接口
   - 验证响应状态码和数据格式

2. **认证流程测试**
   - 各端实现登录功能
   - 验证 token 生成和存储
   - 验证 token 在后续请求中的使用

3. **数据交互测试**
   - 各端获取车辆列表
   - 验证数据格式一致性
   - 验证分页、筛选等功能

4. **错误处理测试**
   - 测试网络错误处理
   - 测试 401 未授权处理
   - 测试 500 服务器错误处理

#### 5.3 测试文档
- 记录测试结果
- 记录发现的问题
- 记录解决方案

## 实施计划

### 阶段 1: 后端 API 实现 (预计 1 天)
- 实现认证 API
- 实现测试 API
- 配置数据库集成
- 完善中间件

### 阶段 2: 前端集成 (预计 1 天)
- C 端小程序集成
- PC 管理端集成
- 移动管理端集成

### 阶段 3: 联调测试 (预计 0.5 天)
- 执行测试用例
- 修复发现的问题
- 编写测试文档

## 成功标准

1. ✅ 后端所有 API 接口正常工作
2. ✅ C 端小程序能成功调用后端 API
3. ✅ PC 管理端能成功调用后端 API
4. ✅ 移动管理端能成功调用后端 API
5. ✅ 所有端的登录认证流程正常
6. ✅ 数据在各端之间保持一致
7. ✅ 错误处理机制正常工作
8. ✅ 完成测试文档编写

## 风险和缓解措施

### 风险 1: 跨域问题
- **缓解**: 后端正确配置 CORS,允许所有开发环境的域名

### 风险 2: 小程序网络请求限制
- **缓解**: 配置小程序合法域名,开发阶段启用"不校验合法域名"

### 风险 3: Token 存储和传递
- **缓解**: 统一使用 localStorage/Storage API,请求拦截器自动添加

### 风险 4: 数据格式不一致
- **缓解**: 后端统一响应格式,前端统一解析逻辑

## 依赖

- 依赖提案: `setup-development-environment` (必须完成)
- 外部依赖: Docker (MySQL, Redis), Node.js, npm

## 参考资料

- [Koa2 官方文档](https://koajs.com/)
- [TypeORM 官方文档](https://typeorm.io/)
- [Taro 官方文档](https://taro-docs.jd.com/)
- [Vue 3 官方文档](https://vuejs.org/)
- [Element Plus 官方文档](https://element-plus.org/)


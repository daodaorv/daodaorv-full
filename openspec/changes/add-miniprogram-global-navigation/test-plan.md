# 测试计划: 小程序端全局导航与路由系统

**Change ID**: `add-miniprogram-global-navigation`  
**测试日期**: 2025-10-28  
**测试人员**: AI Assistant

---

## 1. 测试环境

### 1.1 开发环境
- **IDE**: HBuilderX
- **框架**: uni-app 3.x
- **语言**: TypeScript 5.x
- **状态管理**: Pinia

### 1.2 测试平台
- [ ] 微信开发者工具(微信小程序)
- [ ] Chrome 浏览器(H5)
- [ ] 支付宝开发者工具(支付宝小程序)

---

## 2. 功能测试

### 2.1 TabBar 导航测试

#### 测试用例 1: TabBar 显示
- **前置条件**: 应用启动
- **测试步骤**: 
  1. 打开应用
  2. 查看底部 TabBar
- **预期结果**:
  - [ ] TabBar 正常显示
  - [ ] 包含 4 个导航项:首页、社区、客服、我的
  - [ ] 图标显示正确
  - [ ] 文字显示正确
  - [ ] 当前页面对应的导航项高亮

#### 测试用例 2: TabBar 切换
- **前置条件**: 应用启动
- **测试步骤**:
  1. 点击"社区"导航项
  2. 点击"客服"导航项
  3. 点击"我的"导航项
  4. 点击"首页"导航项
- **预期结果**:
  - [ ] 页面切换流畅,无卡顿
  - [ ] 图标状态正确切换(选中/未选中)
  - [ ] 页面内容正确显示

---

### 2.2 登录拦截测试

#### 测试用例 3: 未登录访问需要登录的页面
- **前置条件**: 用户未登录
- **测试步骤**:
  1. 点击"我的"TabBar 项
- **预期结果**:
  - [ ] 显示提示"请先登录"
  - [ ] 跳转到登录页
  - [ ] 保存原始目标路径 `/pages/mine/index`

#### 测试用例 4: 已登录访问需要登录的页面
- **前置条件**: 用户已登录
- **测试步骤**:
  1. 点击"我的"TabBar 项
- **预期结果**:
  - [ ] 直接进入"我的"页面
  - [ ] 不显示拦截提示

---

### 2.3 实名认证拦截测试

#### 测试用例 5: 未实名认证访问需要实名的页面
- **前置条件**: 用户已登录但未实名认证
- **测试步骤**:
  1. 在测试页面点击"跳转到订单确认"
- **预期结果**:
  - [ ] 显示提示"请先完成实名认证"
  - [ ] 跳转到实名认证页
  - [ ] 保存原始目标路径 `/pages/order/confirm?vehicleId=123`

#### 测试用例 6: 已实名认证访问需要实名的页面
- **前置条件**: 用户已登录且已实名认证
- **测试步骤**:
  1. 在测试页面点击"跳转到订单确认"
- **预期结果**:
  - [ ] 直接进入订单确认页
  - [ ] 不显示拦截提示

---

### 2.4 驾照认证拦截测试

#### 测试用例 7: 未驾照认证访问需要驾照的页面
- **前置条件**: 用户已登录、已实名认证但未驾照认证
- **测试步骤**:
  1. 在测试页面点击"跳转到房车租赁"
- **预期结果**:
  - [ ] 显示提示"请先完成驾照认证"
  - [ ] 跳转到驾照认证页
  - [ ] 保存原始目标路径 `/pages/rv-rental/order-confirm?vehicleId=123`

#### 测试用例 8: 已驾照认证访问需要驾照的页面
- **前置条件**: 用户已登录、已实名认证且已驾照认证
- **测试步骤**:
  1. 在测试页面点击"跳转到房车租赁"
- **预期结果**:
  - [ ] 直接进入房车租赁订单确认页
  - [ ] 不显示拦截提示

---

### 2.5 路由跳转方法测试

#### 测试用例 9: navigateTo 方法
- **测试步骤**:
  1. 调用 `router.navigateTo({ url: '/pages/test-router/index' })`
- **预期结果**:
  - [ ] 跳转到目标页面
  - [ ] 保留当前页面在页面栈中
  - [ ] 可以通过返回按钮返回上一页

#### 测试用例 10: redirectTo 方法
- **测试步骤**:
  1. 调用 `router.redirectTo({ url: '/pages/login/index' })`
- **预期结果**:
  - [ ] 跳转到目标页面
  - [ ] 关闭当前页面
  - [ ] 无法通过返回按钮返回上一页

#### 测试用例 11: switchTab 方法
- **测试步骤**:
  1. 调用 `router.switchTab({ url: '/pages/index/index' })`
- **预期结果**:
  - [ ] 跳转到 TabBar 页面
  - [ ] 关闭所有非 TabBar 页面
  - [ ] TabBar 高亮状态正确

#### 测试用例 12: reLaunch 方法
- **测试步骤**:
  1. 调用 `router.reLaunch({ url: '/pages/index/index' })`
- **预期结果**:
  - [ ] 跳转到目标页面
  - [ ] 关闭所有页面
  - [ ] 页面栈只有一个页面

#### 测试用例 13: navigateBack 方法
- **测试步骤**:
  1. 调用 `router.navigateBack()`
- **预期结果**:
  - [ ] 返回上一页
  - [ ] 关闭当前页面

---

### 2.6 用户状态管理测试

#### 测试用例 14: 应用启动时恢复用户状态
- **前置条件**: localStorage 中有用户 token 和信息
- **测试步骤**:
  1. 关闭应用
  2. 重新打开应用
- **预期结果**:
  - [ ] 用户登录状态恢复
  - [ ] 用户信息恢复
  - [ ] 认证状态恢复

#### 测试用例 15: 退出登录清除状态
- **前置条件**: 用户已登录
- **测试步骤**:
  1. 调用 `userStore.logout()`
- **预期结果**:
  - [ ] 清除 token
  - [ ] 清除用户信息
  - [ ] 清除 localStorage
  - [ ] 跳转到登录页

---

### 2.7 重定向路径管理测试

#### 测试用例 16: 保存重定向路径
- **前置条件**: 用户未登录
- **测试步骤**:
  1. 访问需要登录的页面 `/pages/mine/index`
- **预期结果**:
  - [ ] 重定向路径保存为 `/pages/mine/index`
  - [ ] 可以通过 `router.getRedirectPath()` 获取

#### 测试用例 17: 登录后返回原页面
- **前置条件**: 有保存的重定向路径
- **测试步骤**:
  1. 完成登录
  2. 获取重定向路径
  3. 跳转到重定向路径
  4. 清除重定向路径
- **预期结果**:
  - [ ] 成功跳转到原目标页面
  - [ ] 重定向路径已清除

---

## 3. 性能测试

### 3.1 路由跳转性能

#### 测试用例 18: 路由跳转响应时间
- **测试步骤**:
  1. 记录跳转开始时间
  2. 执行路由跳转
  3. 记录跳转完成时间
- **预期结果**:
  - [ ] 跳转响应时间 < 100ms

#### 测试用例 19: 拦截器执行时间
- **测试步骤**:
  1. 记录拦截器开始时间
  2. 执行权限检查
  3. 记录拦截器完成时间
- **预期结果**:
  - [ ] 拦截器执行时间 < 50ms

---

## 4. 兼容性测试

### 4.1 微信小程序平台

#### 测试用例 20: 微信小程序路由功能
- **测试平台**: 微信开发者工具
- **测试步骤**:
  1. 测试所有路由跳转方法
  2. 测试所有拦截场景
- **预期结果**:
  - [ ] 所有功能正常工作
  - [ ] 无报错

### 4.2 H5 平台

#### 测试用例 21: H5 路由功能
- **测试平台**: Chrome 浏览器
- **测试步骤**:
  1. 测试所有路由跳转方法
  2. 测试所有拦截场景
- **预期结果**:
  - [ ] 所有功能正常工作
  - [ ] URL 地址栏正确更新
  - [ ] 无报错

---

## 5. 测试结果汇总

### 5.1 测试统计
- **总测试用例数**: 21
- **通过数**: 0
- **失败数**: 0
- **未执行数**: 21
- **通过率**: 0%

### 5.2 问题清单
| 序号 | 问题描述 | 严重程度 | 状态 |
|------|---------|---------|------|
| -    | -       | -       | -    |

### 5.3 测试结论
- [ ] 所有测试用例通过,功能符合预期
- [ ] 存在问题,需要修复后重新测试

---

## 6. 下一步行动

### 6.1 待完成任务
1. [ ] 在 HBuilderX 中编译项目
2. [ ] 在微信开发者工具中执行测试
3. [ ] 在 Chrome 浏览器中执行测试
4. [ ] 记录测试结果
5. [ ] 修复发现的问题
6. [ ] 更新 OpenSpec tasks.md

### 6.2 优化建议
1. 添加路由跳转动画
2. 优化拦截提示样式
3. 添加路由跳转日志
4. 添加错误处理机制


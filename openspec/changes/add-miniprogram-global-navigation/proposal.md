# Proposal: å°ç¨‹åºç«¯å…¨å±€å¯¼èˆªä¸è·¯ç”±ç³»ç»Ÿ

**Change ID**: `add-miniprogram-global-navigation`  
**Status**: ğŸŸ¡ In Progress  
**Created**: 2025-10-28  
**Author**: AI Assistant  
**Priority**: P0 (æ ¸å¿ƒåŠŸèƒ½)

---

## Why

### ä¸šåŠ¡ä»·å€¼
å°ç¨‹åºç«¯å…¨å±€å¯¼èˆªä¸è·¯ç”±ç³»ç»Ÿæ˜¯æ•´ä¸ªå°ç¨‹åºåº”ç”¨çš„åŸºç¡€è®¾æ–½,å¿…é¡»åœ¨æ‰€æœ‰ä¸šåŠ¡åŠŸèƒ½å¼€å‘ä¹‹å‰å®Œæˆã€‚è¯¥ç³»ç»Ÿå°†:

1. **ç»Ÿä¸€ç”¨æˆ·ä½“éªŒ**: æä¾›ä¸€è‡´çš„å¯¼èˆªä½“éªŒ,ç”¨æˆ·å¯ä»¥å¿«é€Ÿåœ¨ä¸åŒåŠŸèƒ½æ¨¡å—ä¹‹é—´åˆ‡æ¢
2. **æƒé™æ§åˆ¶**: å®ç°ç™»å½•æ‹¦æˆªã€å®åè®¤è¯æ‹¦æˆªã€é©¾ç…§è®¤è¯æ‹¦æˆª,ä¿éšœä¸šåŠ¡æµç¨‹çš„åˆè§„æ€§
3. **æå‡å¼€å‘æ•ˆç‡**: å°è£…è·¯ç”±è·³è½¬æ–¹æ³•,ç®€åŒ–åç»­ä¸šåŠ¡åŠŸèƒ½çš„å¼€å‘
4. **æ”¯æŒå¤šç«¯éƒ¨ç½²**: å…¼å®¹å¾®ä¿¡å°ç¨‹åºã€æ”¯ä»˜å®å°ç¨‹åºã€æŠ–éŸ³å°ç¨‹åºã€H5 ç­‰å¤šä¸ªå¹³å°

### é—®é¢˜é™ˆè¿°
å½“å‰å°ç¨‹åºç«¯é¡¹ç›®å·²å®ŒæˆåŸºç¡€ç¯å¢ƒé…ç½®,ä½†ç¼ºå°‘:
- TabBar å¯¼èˆªçš„å®é™…å®ç°
- è·¯ç”±æ‹¦æˆªå™¨(ç™»å½•ã€è®¤è¯ç­‰)
- ç»Ÿä¸€çš„è·¯ç”±è·³è½¬å°è£…
- é¡µé¢æƒé™ç®¡ç†æœºåˆ¶

### ç›®æ ‡
å®ç°ä¸€ä¸ªå®Œæ•´çš„å…¨å±€å¯¼èˆªä¸è·¯ç”±ç³»ç»Ÿ,åŒ…æ‹¬:
1. TabBar å¯¼èˆª(é¦–é¡µ/ç¤¾åŒº/å®¢æœ/æˆ‘çš„)
2. è·¯ç”±æ‹¦æˆªå™¨(ç™»å½•ã€å®åè®¤è¯ã€é©¾ç…§è®¤è¯)
3. è·¯ç”±è·³è½¬å°è£…(navigateTo, redirectTo, switchTab ç­‰)
4. é¡µé¢æƒé™ç®¡ç†(ç™½åå•ã€è®¤è¯è¦æ±‚ç­‰)

---

## What

### åŠŸèƒ½èŒƒå›´

#### 1. TabBar å¯¼èˆª
- **é¦–é¡µ**: å±•ç¤ºæ¨èè½¦è¾†ã€è¥åœ°ã€æ—…æ¸¸è·¯çº¿ç­‰
- **ç¤¾åŒº**: æˆ¿è½¦ç”Ÿæ´»åˆ†äº«ã€æ”»ç•¥ã€æ´»åŠ¨ç­‰
- **å®¢æœ**: åœ¨çº¿å®¢æœã€å¸¸è§é—®é¢˜ã€å·¥å•ç­‰
- **æˆ‘çš„**: ä¸ªäººä¸­å¿ƒã€è®¢å•ã€é’±åŒ…ã€è®¾ç½®ç­‰

#### 2. è·¯ç”±æ‹¦æˆªå™¨
- **ç™»å½•æ‹¦æˆª**: æœªç™»å½•ç”¨æˆ·è®¿é—®éœ€è¦ç™»å½•çš„é¡µé¢æ—¶,è·³è½¬åˆ°ç™»å½•é¡µ
- **å®åè®¤è¯æ‹¦æˆª**: æœªå®åè®¤è¯ç”¨æˆ·è®¿é—®éœ€è¦å®åçš„é¡µé¢æ—¶,è·³è½¬åˆ°å®åè®¤è¯é¡µ
- **é©¾ç…§è®¤è¯æ‹¦æˆª**: æœªé©¾ç…§è®¤è¯ç”¨æˆ·è®¿é—®éœ€è¦é©¾ç…§çš„é¡µé¢æ—¶,è·³è½¬åˆ°é©¾ç…§è®¤è¯é¡µ

#### 3. è·¯ç”±è·³è½¬å°è£…
- `navigateTo`: ä¿ç•™å½“å‰é¡µé¢,è·³è½¬åˆ°åº”ç”¨å†…çš„æŸä¸ªé¡µé¢
- `redirectTo`: å…³é—­å½“å‰é¡µé¢,è·³è½¬åˆ°åº”ç”¨å†…çš„æŸä¸ªé¡µé¢
- `switchTab`: è·³è½¬åˆ° tabBar é¡µé¢,å¹¶å…³é—­å…¶ä»–æ‰€æœ‰é tabBar é¡µé¢
- `reLaunch`: å…³é—­æ‰€æœ‰é¡µé¢,æ‰“å¼€åˆ°åº”ç”¨å†…çš„æŸä¸ªé¡µé¢
- `navigateBack`: å…³é—­å½“å‰é¡µé¢,è¿”å›ä¸Šä¸€é¡µé¢æˆ–å¤šçº§é¡µé¢

#### 4. é¡µé¢æƒé™ç®¡ç†
- ç™½åå•é¡µé¢(æ— éœ€ç™»å½•): é¦–é¡µã€ç¤¾åŒºã€ç™»å½•ã€æ³¨å†Œç­‰
- éœ€è¦ç™»å½•çš„é¡µé¢: æˆ‘çš„ã€è®¢å•ã€é’±åŒ…ç­‰
- éœ€è¦å®åè®¤è¯çš„é¡µé¢: è®¢å•ç¡®è®¤ã€æ”¯ä»˜ç­‰
- éœ€è¦é©¾ç…§è®¤è¯çš„é¡µé¢: æˆ¿è½¦ç§Ÿèµè®¢å•ç¡®è®¤ç­‰

### æŠ€æœ¯å®ç°

#### 1. TabBar é…ç½®
åœ¨ `pages.json` ä¸­é…ç½® TabBar:
```json
{
  "tabBar": {
    "color": "#999999",
    "selectedColor": "#FF6B00",
    "backgroundColor": "#FFFFFF",
    "borderStyle": "black",
    "list": [
      {
        "pagePath": "pages/index/index",
        "text": "é¦–é¡µ",
        "iconPath": "static/tabbar/home.png",
        "selectedIconPath": "static/tabbar/home-active.png"
      },
      {
        "pagePath": "pages/community/index",
        "text": "ç¤¾åŒº",
        "iconPath": "static/tabbar/community.png",
        "selectedIconPath": "static/tabbar/community-active.png"
      },
      {
        "pagePath": "pages/customer-service/index",
        "text": "å®¢æœ",
        "iconPath": "static/tabbar/service.png",
        "selectedIconPath": "static/tabbar/service-active.png"
      },
      {
        "pagePath": "pages/profile/index",
        "text": "æˆ‘çš„",
        "iconPath": "static/tabbar/profile.png",
        "selectedIconPath": "static/tabbar/profile-active.png"
      }
    ]
  }
}
```

#### 2. è·¯ç”±æ‹¦æˆªå™¨å®ç°
åœ¨ `utils/router.ts` ä¸­å®ç°è·¯ç”±æ‹¦æˆªå™¨:
```typescript
// è·¯ç”±æ‹¦æˆªå™¨
export function routerInterceptor(url: string, options?: any) {
  const userStore = useUserStore();
  const pageConfig = getPageConfig(url);
  
  // æ£€æŸ¥ç™»å½•çŠ¶æ€
  if (pageConfig.requireLogin && !userStore.isLoggedIn) {
    uni.navigateTo({ url: '/pages/auth/login' });
    return false;
  }
  
  // æ£€æŸ¥å®åè®¤è¯
  if (pageConfig.requireRealName && !userStore.isRealNameVerified) {
    uni.navigateTo({ url: '/pages/auth/real-name' });
    return false;
  }
  
  // æ£€æŸ¥é©¾ç…§è®¤è¯
  if (pageConfig.requireDrivingLicense && !userStore.isDrivingLicenseVerified) {
    uni.navigateTo({ url: '/pages/auth/driving-license' });
    return false;
  }
  
  return true;
}
```

#### 3. è·¯ç”±è·³è½¬å°è£…
åœ¨ `utils/router.ts` ä¸­å°è£…è·¯ç”±è·³è½¬æ–¹æ³•:
```typescript
export const router = {
  navigateTo(url: string, options?: any) {
    if (routerInterceptor(url, options)) {
      uni.navigateTo({ url, ...options });
    }
  },
  
  redirectTo(url: string, options?: any) {
    if (routerInterceptor(url, options)) {
      uni.redirectTo({ url, ...options });
    }
  },
  
  switchTab(url: string, options?: any) {
    uni.switchTab({ url, ...options });
  },
  
  reLaunch(url: string, options?: any) {
    uni.reLaunch({ url, ...options });
  },
  
  navigateBack(delta: number = 1) {
    uni.navigateBack({ delta });
  }
};
```

#### 4. é¡µé¢æƒé™é…ç½®
åœ¨ `config/page-auth.ts` ä¸­é…ç½®é¡µé¢æƒé™:
```typescript
export const pageAuthConfig = {
  // ç™½åå•é¡µé¢(æ— éœ€ç™»å½•)
  whitelist: [
    '/pages/index/index',
    '/pages/community/index',
    '/pages/auth/login',
    '/pages/auth/register',
  ],
  
  // éœ€è¦ç™»å½•çš„é¡µé¢
  requireLogin: [
    '/pages/profile/index',
    '/pages/order/list',
    '/pages/wallet/index',
  ],
  
  // éœ€è¦å®åè®¤è¯çš„é¡µé¢
  requireRealName: [
    '/pages/order/confirm',
    '/pages/payment/index',
  ],
  
  // éœ€è¦é©¾ç…§è®¤è¯çš„é¡µé¢
  requireDrivingLicense: [
    '/pages/order/confirm', // æˆ¿è½¦ç§Ÿèµè®¢å•ç¡®è®¤
  ]
};
```

### ä¾èµ–å…³ç³»
- **å‰ç½®ä¾èµ–**: 
  - âœ… uni-app ç¯å¢ƒé…ç½®å®Œæˆ
  - âœ… HBuilderX å¯æ­£å¸¸ç¼–è¯‘
  - âœ… TabBar å›¾æ ‡å·²å‡†å¤‡
  - âœ… Pinia çŠ¶æ€ç®¡ç†å·²é…ç½®
  - âœ… åç«¯ç”¨æˆ·è®¤è¯ API å·²å®Œæˆ

- **åç»­ä¾èµ–**: 
  - æ‰€æœ‰ä¸šåŠ¡åŠŸèƒ½æ¨¡å—éƒ½ä¾èµ–æœ¬ç³»ç»Ÿ

### å½±å“èŒƒå›´
- **æ–°å¢æ–‡ä»¶**:
  - `utils/router.ts` - è·¯ç”±å°è£…ä¸æ‹¦æˆªå™¨
  - `config/page-auth.ts` - é¡µé¢æƒé™é…ç½®
  - `stores/user.ts` - ç”¨æˆ·çŠ¶æ€ç®¡ç†(å·²å­˜åœ¨,éœ€å®Œå–„)
  
- **ä¿®æ”¹æ–‡ä»¶**:
  - `pages.json` - TabBar é…ç½®
  - `main.ts` - æ³¨å†Œè·¯ç”±æ‹¦æˆªå™¨

---

## How

### å®æ–½è®¡åˆ’

#### é˜¶æ®µ 1: TabBar é…ç½®ä¸é¡µé¢åˆ›å»º (1 å¤©)
1. é…ç½® `pages.json` ä¸­çš„ TabBar
2. ç¡®è®¤ TabBar å›¾æ ‡è·¯å¾„æ­£ç¡®
3. åˆ›å»º 4 ä¸ª TabBar é¡µé¢çš„åŸºç¡€ç»“æ„
4. æµ‹è¯• TabBar åˆ‡æ¢åŠŸèƒ½

#### é˜¶æ®µ 2: è·¯ç”±æ‹¦æˆªå™¨å®ç° (1 å¤©)
1. å®ç° `utils/router.ts` è·¯ç”±å°è£…
2. å®ç°è·¯ç”±æ‹¦æˆªå™¨é€»è¾‘
3. é…ç½® `config/page-auth.ts` é¡µé¢æƒé™
4. åœ¨ `main.ts` ä¸­æ³¨å†Œè·¯ç”±æ‹¦æˆªå™¨

#### é˜¶æ®µ 3: ç”¨æˆ·çŠ¶æ€ç®¡ç†å®Œå–„ (1 å¤©)
1. å®Œå–„ `stores/user.ts` ç”¨æˆ·çŠ¶æ€
2. å®ç°ç™»å½•çŠ¶æ€æŒä¹…åŒ–
3. å®ç°è®¤è¯çŠ¶æ€è·å–
4. å®ç° token è‡ªåŠ¨åˆ·æ–°

#### é˜¶æ®µ 4: æµ‹è¯•ä¸ä¼˜åŒ– (1 å¤©)
1. æµ‹è¯• TabBar å¯¼èˆªåŠŸèƒ½
2. æµ‹è¯•è·¯ç”±æ‹¦æˆªå™¨(ç™»å½•ã€å®åã€é©¾ç…§)
3. æµ‹è¯•å¤šç«¯å…¼å®¹æ€§(å¾®ä¿¡ã€H5)
4. æ€§èƒ½ä¼˜åŒ–ä¸ä»£ç å®¡æŸ¥

### éªŒæ”¶æ ‡å‡†
- [ ] TabBar å¯¼èˆªæ­£å¸¸æ˜¾ç¤º,å›¾æ ‡æ­£ç¡®,å¯ä»¥åˆ‡æ¢
- [ ] æœªç™»å½•ç”¨æˆ·è®¿é—®éœ€è¦ç™»å½•çš„é¡µé¢æ—¶,è·³è½¬åˆ°ç™»å½•é¡µ
- [ ] æœªå®åè®¤è¯ç”¨æˆ·è®¿é—®éœ€è¦å®åçš„é¡µé¢æ—¶,è·³è½¬åˆ°å®åè®¤è¯é¡µ
- [ ] æœªé©¾ç…§è®¤è¯ç”¨æˆ·è®¿é—®éœ€è¦é©¾ç…§çš„é¡µé¢æ—¶,è·³è½¬åˆ°é©¾ç…§è®¤è¯é¡µ
- [ ] è·¯ç”±è·³è½¬å°è£…æ–¹æ³•å¯ä»¥æ­£å¸¸ä½¿ç”¨
- [ ] å¾®ä¿¡å°ç¨‹åºã€H5 å¹³å°æµ‹è¯•é€šè¿‡
- [ ] ä»£ç ç¬¦åˆ ESLint è§„èŒƒ
- [ ] æ—  TypeScript ç±»å‹é”™è¯¯

### é£é™©ä¸ç¼“è§£æªæ–½

#### é£é™© 1: uni-app å¤šç«¯è·¯ç”±å·®å¼‚
- **å½±å“**: ä¸åŒå¹³å°çš„è·¯ç”±è¡Œä¸ºå¯èƒ½ä¸ä¸€è‡´
- **ç¼“è§£**: ä½¿ç”¨æ¡ä»¶ç¼–è¯‘å¤„ç†å¹³å°å·®å¼‚,åœ¨å¤šä¸ªå¹³å°æµ‹è¯•

#### é£é™© 2: è·¯ç”±æ‹¦æˆªå™¨æ€§èƒ½é—®é¢˜
- **å½±å“**: æ¯æ¬¡è·¯ç”±è·³è½¬éƒ½éœ€è¦æ£€æŸ¥æƒé™,å¯èƒ½å½±å“æ€§èƒ½
- **ç¼“è§£**: ä¼˜åŒ–æ‹¦æˆªå™¨é€»è¾‘,ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤è®¡ç®—

#### é£é™© 3: è®¤è¯çŠ¶æ€åŒæ­¥é—®é¢˜
- **å½±å“**: ç”¨æˆ·è®¤è¯çŠ¶æ€å¯èƒ½ä¸åŒæ­¥,å¯¼è‡´æ‹¦æˆªå™¨åˆ¤æ–­é”™è¯¯
- **ç¼“è§£**: å®ç°è®¤è¯çŠ¶æ€è‡ªåŠ¨åˆ·æ–°æœºåˆ¶,å®šæœŸåŒæ­¥ç”¨æˆ·ä¿¡æ¯

---

## Success Metrics

### åŠŸèƒ½æŒ‡æ ‡
- TabBar å¯¼èˆªåˆ‡æ¢æˆåŠŸç‡ = 100%
- è·¯ç”±æ‹¦æˆªå™¨å‡†ç¡®ç‡ = 100%
- å¤šç«¯å…¼å®¹æ€§æµ‹è¯•é€šè¿‡ç‡ = 100%

### æ€§èƒ½æŒ‡æ ‡
- è·¯ç”±è·³è½¬å“åº”æ—¶é—´ < 100ms
- æ‹¦æˆªå™¨æ‰§è¡Œæ—¶é—´ < 50ms

### è´¨é‡æŒ‡æ ‡
- ä»£ç æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- TypeScript ç±»å‹è¦†ç›–ç‡ = 100%
- ESLint æ£€æŸ¥é€šè¿‡ç‡ = 100%

---

## References

- [uni-app è·¯ç”±ä¸é¡µé¢è·³è½¬](https://uniapp.dcloud.net.cn/api/router.html)
- [uni-app TabBar é…ç½®](https://uniapp.dcloud.net.cn/collocation/pages.html#tabbar)
- [Pinia çŠ¶æ€ç®¡ç†](https://pinia.vuejs.org/)
- `docs/å°ç¨‹åºç«¯åŠŸèƒ½è¯¦ç»†è®¾è®¡-ä¼˜åŒ–ç‰ˆ.md` - 5.1 å…¨å±€å¯¼èˆª(TabBar)
- `docs/æŠ€æœ¯è§„èŒƒæ‰‹å†Œ.md` - æŠ€æœ¯æ ˆè§„èŒƒ


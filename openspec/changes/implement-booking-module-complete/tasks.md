# 实现任务清单

## 1. 准备工作

- [ ] 1.1 创建 API 接口文件 `api/modules/booking.ts`
- [ ] 1.2 创建类型定义文件 `types/booking.d.ts`
- [ ] 1.3 准备 Mock 数据用于开发测试

## 2. 选择器组件开发

- [ ] 2.1 创建城市选择器组件 `CityPicker.vue`
  - [ ] 2.1.1 实现城市列表展示(热门城市 + 全部城市)
  - [ ] 2.1.2 实现搜索功能
  - [ ] 2.1.3 实现选中状态和确认逻辑
  - [ ] 2.1.4 添加加载状态和空状态

- [ ] 2.2 创建门店选择器组件 `StorePicker.vue`
  - [ ] 2.2.1 实现门店列表展示
  - [ ] 2.2.2 显示门店详细信息(地址、营业时间)
  - [ ] 2.2.3 实现选中状态和确认逻辑
  - [ ] 2.2.4 添加加载状态和空状态

- [ ] 2.3 创建日期时间选择器组件 `DateTimePicker.vue`
  - [ ] 2.3.1 实现日期选择(限制范围:当前+4小时 到 +6个月)
  - [ ] 2.3.2 实现时间选择(仅显示营业时间段)
  - [ ] 2.3.3 实现取还车时间点同步逻辑
  - [ ] 2.3.4 实时计算并显示租期天数
  - [ ] 2.3.5 添加时间验证提示

## 3. BookingModule 组件增强

- [ ] 3.1 集成城市选择器
  - [ ] 3.1.1 点击取车城市打开选择器
  - [ ] 3.1.2 点击还车城市打开选择器(异地还车时)
  - [ ] 3.1.3 城市变更后自动更新门店列表

- [ ] 3.2 集成门店选择器
  - [ ] 3.2.1 点击取车门店打开选择器
  - [ ] 3.2.2 点击还车门店打开选择器(异地还车时)
  - [ ] 3.2.3 根据选中城市过滤门店

- [ ] 3.3 集成时间选择器
  - [ ] 3.3.1 点击取车时间打开选择器
  - [ ] 3.3.2 点击还车时间打开选择器
  - [ ] 3.3.3 实现时间点同步逻辑
  - [ ] 3.3.4 实时更新租期天数显示

- [ ] 3.4 异地还车功能
  - [ ] 3.4.1 开关切换时展开/收起还车地点选择
  - [ ] 3.4.2 开启时初始化还车城市和门店
  - [ ] 3.4.3 关闭时清空还车地点数据

## 4. 数据验证逻辑

- [ ] 4.1 必填字段验证
  - [ ] 4.1.1 验证取车城市已选择
  - [ ] 4.1.2 验证取车门店已选择
  - [ ] 4.1.3 验证取车时间已选择
  - [ ] 4.1.4 验证还车时间已选择
  - [ ] 4.1.5 异地还车时验证还车城市和门店

- [ ] 4.2 时间逻辑验证
  - [ ] 4.2.1 验证取车时间 >= 当前时间+4小时
  - [ ] 4.2.2 验证取车时间 <= 当前时间+6个月
  - [ ] 4.2.3 验证还车时间 > 取车时间
  - [ ] 4.2.4 验证租期 >= 2天(48小时)
  - [ ] 4.2.5 验证租期 <= 60天
  - [ ] 4.2.6 验证取还车时间点一致

- [ ] 4.3 错误提示
  - [ ] 4.3.1 实现统一的错误提示函数
  - [ ] 4.3.2 为每种验证失败提供友好提示
  - [ ] 4.3.3 支持自动聚焦到错误字段

## 5. 默认值和智能设置

- [ ] 5.1 实现用户选择记录
  - [ ] 5.1.1 使用 localStorage 保存用户上次选择
  - [ ] 5.1.2 页面加载时读取历史选择
  - [ ] 5.1.3 每次查询后更新记录

- [ ] 5.2 实现自动定位
  - [ ] 5.2.1 调用微信定位 API 获取用户位置
  - [ ] 5.2.2 根据经纬度匹配最近城市
  - [ ] 5.2.3 定位失败时使用默认城市(深圳)

- [ ] 5.3 实现智能默认时间
  - [ ] 5.3.1 取车时间 = 当前时间+4小时,取整点
  - [ ] 5.3.2 还车时间 = 取车时间+2天,时间点同步
  - [ ] 5.3.3 考虑营业时间限制

## 6. API 对接

- [ ] 6.1 实现 API 接口函数
  - [ ] 6.1.1 `getCities()` - 获取可用城市列表
  - [ ] 6.1.2 `getStores(cityId)` - 获取城市门店列表
  - [ ] 6.1.3 `searchVehicles(params)` - 查询可用房车
  - [ ] 6.1.4 `saveBookingRecord(params)` - 保存用户选择记录

- [ ] 6.2 实现数据缓存
  - [ ] 6.2.1 缓存城市列表(1小时)
  - [ ] 6.2.2 缓存门店列表(1小时)
  - [ ] 6.2.3 实现缓存失效和刷新机制

- [ ] 6.3 实现错误处理
  - [ ] 6.3.1 网络错误处理
  - [ ] 6.3.2 API 错误处理
  - [ ] 6.3.3 超时处理
  - [ ] 6.3.4 提供重试机制

## 7. 状态管理

- [ ] 7.1 使用 Pinia 管理预订状态
  - [ ] 7.1.1 创建 `useBookingStore`
  - [ ] 7.1.2 管理城市、门店、时间等状态
  - [ ] 7.1.3 提供 actions 用于更新状态
  - [ ] 7.1.4 实现状态持久化

## 8. 交互优化

- [ ] 8.1 添加加载状态
  - [ ] 8.1.1 城市列表加载中
  - [ ] 8.1.2 门店列表加载中
  - [ ] 8.1.3 查询房车加载中

- [ ] 8.2 添加过渡动画
  - [ ] 8.2.1 异地还车展开/收起动画
  - [ ] 8.2.2 选择器弹出/关闭动画
  - [ ] 8.2.3 按钮点击反馈

- [ ] 8.3 优化用户体验
  - [ ] 8.3.1 防抖处理(搜索、查询)
  - [ ] 8.3.2 禁用重复提交
  - [ ] 8.3.3 优化触摸反馈

## 9. 测试

- [ ] 9.1 单元测试
  - [ ] 9.1.1 测试数据验证函数
  - [ ] 9.1.2 测试时间计算函数
  - [ ] 9.1.3 测试默认值生成函数

- [ ] 9.2 组件测试
  - [ ] 9.2.1 测试 CityPicker 组件
  - [ ] 9.2.2 测试 StorePicker 组件
  - [ ] 9.2.3 测试 DateTimePicker 组件
  - [ ] 9.2.4 测试 BookingModule 组件

- [ ] 9.3 集成测试
  - [ ] 9.3.1 测试完整预订流程
  - [ ] 9.3.2 测试异地还车流程
  - [ ] 9.3.3 测试各种异常场景

- [ ] 9.4 用户测试
  - [ ] 9.4.1 在微信开发者工具中测试
  - [ ] 9.4.2 在真机上测试
  - [ ] 9.4.3 收集用户反馈并优化

## 10. 文档和部署

- [ ] 10.1 更新组件文档
  - [ ] 10.1.1 编写 BookingModule 使用文档
  - [ ] 10.1.2 编写选择器组件使用文档
  - [ ] 10.1.3 编写 API 接口文档

- [ ] 10.2 代码审查
  - [ ] 10.2.1 自我审查代码质量
  - [ ] 10.2.2 确保符合项目规范
  - [ ] 10.2.3 优化性能

- [ ] 10.3 部署准备
  - [ ] 10.3.1 确认所有测试通过
  - [ ] 10.3.2 准备发布说明
  - [ ] 10.3.3 协调后端 API 上线


# 房车预订模块规范

## ADDED Requirements

### Requirement: 城市选择功能

系统 SHALL 提供城市选择功能,允许用户选择取车和还车城市。

#### Scenario: 用户选择取车城市

- **WHEN** 用户点击"取车城市"字段
- **THEN** 系统打开城市选择器
- **AND** 显示所有有服务的城市列表
- **AND** 热门城市显示在顶部
- **AND** 支持搜索城市名称
- **AND** 用户选择城市后,选择器关闭并更新显示

#### Scenario: 城市列表为空

- **WHEN** 系统无法获取城市列表
- **THEN** 显示"暂无可用城市"提示
- **AND** 提供重试按钮

#### Scenario: 城市搜索

- **WHEN** 用户在搜索框输入城市名称
- **THEN** 实时过滤城市列表
- **AND** 显示匹配的城市
- **AND** 无匹配时显示"未找到相关城市"

---

### Requirement: 门店选择功能

系统 SHALL 提供门店选择功能,根据选中的城市显示该城市的门店列表。

#### Scenario: 用户选择取车门店

- **WHEN** 用户点击"取车门店"字段
- **THEN** 系统打开门店选择器
- **AND** 显示当前选中城市的所有门店
- **AND** 显示门店详细信息(名称、地址、营业时间)
- **AND** 默认门店标记为"推荐"
- **AND** 用户选择门店后,选择器关闭并更新显示

#### Scenario: 城市切换后门店自动更新

- **WHEN** 用户切换取车城市
- **THEN** 系统自动加载新城市的门店列表
- **AND** 取车门店重置为新城市的默认门店

#### Scenario: 门店列表为空

- **WHEN** 选中城市没有可用门店
- **THEN** 显示"该城市暂无可用门店"提示
- **AND** 建议用户选择其他城市

---

### Requirement: 时间选择功能

系统 SHALL 提供取车和还车时间选择功能,并验证时间业务规则。

#### Scenario: 用户选择取车时间

- **WHEN** 用户点击"取车时间"字段
- **THEN** 系统打开日期时间选择器
- **AND** 最早可选时间为当前时间+4小时
- **AND** 最晚可选时间为当前时间+6个月
- **AND** 仅显示营业时间段的时间点
- **AND** 用户确认后更新取车时间显示

#### Scenario: 用户选择还车时间

- **WHEN** 用户点击"还车时间"字段
- **THEN** 系统打开日期时间选择器
- **AND** 最早可选时间为取车时间+2天
- **AND** 时间点自动同步为取车时间点
- **AND** 用户确认后更新还车时间显示
- **AND** 系统自动计算并显示租期天数

#### Scenario: 取还车时间点不一致

- **WHEN** 用户选择的还车时间点与取车时间点不同
- **THEN** 系统自动调整还车时间点与取车时间点一致
- **AND** 显示提示"已自动调整还车时间点"

#### Scenario: 租期小于最短时长

- **WHEN** 用户选择的租期小于2天(48小时)
- **THEN** 系统显示错误提示"租赁时长至少2天(48小时)"
- **AND** 禁止确认选择

#### Scenario: 租期超过最长时长

- **WHEN** 用户选择的租期超过60天
- **THEN** 系统显示错误提示"租赁时长最长60天"
- **AND** 禁止确认选择

---

### Requirement: 异地还车功能

系统 SHALL 提供异地还车功能,允许用户选择不同的还车城市和门店。

#### Scenario: 用户开启异地还车

- **WHEN** 用户点击"异地还车"开关
- **THEN** 系统展开还车地点选择区域
- **AND** 还车城市默认为取车城市
- **AND** 还车门店默认为该城市的默认门店
- **AND** 显示"异地还车需支付额外费用"提示

#### Scenario: 用户关闭异地还车

- **WHEN** 用户关闭"异地还车"开关
- **THEN** 系统收起还车地点选择区域
- **AND** 还车城市和门店自动设置为取车城市和门店

#### Scenario: 异地还车选择不同城市

- **WHEN** 用户在异地还车模式下选择不同的还车城市
- **THEN** 系统更新还车门店列表
- **AND** 还车门店重置为新城市的默认门店

---

### Requirement: 数据验证功能

系统 SHALL 在用户提交查询前验证所有必填字段和业务规则。

#### Scenario: 必填字段验证

- **WHEN** 用户点击"查询可用房车"按钮
- **THEN** 系统验证所有必填字段已填写
- **AND** 未填写的字段显示错误提示
- **AND** 禁止提交查询

#### Scenario: 时间逻辑验证

- **WHEN** 用户点击"查询可用房车"按钮
- **THEN** 系统验证还车时间晚于取车时间
- **AND** 验证租期在2-60天范围内
- **AND** 验证取还车时间点一致
- **AND** 验证失败时显示具体错误提示

#### Scenario: 验证通过提交查询

- **WHEN** 所有验证通过
- **THEN** 系统调用查询 API
- **AND** 显示加载状态
- **AND** 查询成功后跳转到房车列表页
- **AND** 传递查询参数到列表页

---

### Requirement: 智能默认值功能

系统 SHALL 提供智能默认值,减少用户操作步骤。

#### Scenario: 首次使用默认值

- **WHEN** 用户首次打开预订模块
- **THEN** 系统尝试获取用户定位
- **AND** 定位成功时,取车城市默认为定位城市
- **AND** 定位失败时,取车城市默认为深圳
- **AND** 取车门店默认为该城市的默认门店
- **AND** 取车时间默认为当前时间+4小时(整点)
- **AND** 还车时间默认为取车时间+2天(时间点同步)

#### Scenario: 使用历史选择

- **WHEN** 用户之前使用过预订功能
- **THEN** 系统读取用户上次选择
- **AND** 取车城市和门店默认为上次选择
- **AND** 取车时间默认为当前时间+4小时(整点)
- **AND** 还车时间默认为取车时间+2天

#### Scenario: 时间默认值取整点

- **WHEN** 系统计算默认取车时间
- **THEN** 当前时间+4小时后取整点
- **AND** 例如:当前14:30,默认取车时间为18:00

---

### Requirement: 用户选择记忆功能

系统 SHALL 记住用户的选择,下次打开时自动填充。

#### Scenario: 保存用户选择

- **WHEN** 用户点击"查询可用房车"按钮且验证通过
- **THEN** 系统保存用户选择到本地存储
- **AND** 保存内容包括:取车城市、取车门店、异地还车状态

#### Scenario: 读取历史选择

- **WHEN** 用户打开预订模块
- **THEN** 系统从本地存储读取上次选择
- **AND** 如果存在历史选择,使用历史值作为默认值
- **AND** 如果不存在,使用智能默认值

---

### Requirement: 错误处理功能

系统 SHALL 提供友好的错误提示和处理机制。

#### Scenario: 网络错误处理

- **WHEN** API 请求失败(网络错误)
- **THEN** 系统显示"网络连接失败,请检查网络设置"
- **AND** 提供"重试"按钮
- **AND** 用户点击重试后重新发起请求

#### Scenario: API 错误处理

- **WHEN** API 返回错误(如服务器错误)
- **THEN** 系统显示具体错误信息
- **AND** 提供"重试"或"返回"按钮

#### Scenario: 数据为空处理

- **WHEN** 查询结果为空(无可用房车)
- **THEN** 系统显示"暂无符合条件的房车"
- **AND** 建议用户调整查询条件
- **AND** 提供"重新查询"按钮

---

### Requirement: 加载状态显示

系统 SHALL 在数据加载过程中显示加载状态,提供用户反馈。

#### Scenario: 城市列表加载

- **WHEN** 系统正在加载城市列表
- **THEN** 选择器显示加载动画
- **AND** 显示"加载中..."文字提示

#### Scenario: 查询房车加载

- **WHEN** 用户点击"查询可用房车"按钮
- **THEN** 按钮显示加载状态
- **AND** 按钮文字变为"查询中..."
- **AND** 禁用按钮防止重复点击

#### Scenario: 加载超时处理

- **WHEN** 请求超过30秒未响应
- **THEN** 系统显示"请求超时,请重试"
- **AND** 恢复按钮可点击状态

---

### Requirement: 交互优化

系统 SHALL 提供流畅的交互体验和视觉反馈。

#### Scenario: 异地还车展开动画

- **WHEN** 用户开启异地还车开关
- **THEN** 还车地点选择区域平滑展开
- **AND** 动画时长300ms

#### Scenario: 选择器弹出动画

- **WHEN** 用户点击选择字段
- **THEN** 选择器从底部平滑弹出
- **AND** 背景显示半透明遮罩

#### Scenario: 按钮点击反馈

- **WHEN** 用户点击任何按钮
- **THEN** 按钮显示按下状态
- **AND** 提供触觉反馈(如果设备支持)

---

### Requirement: 数据缓存功能

系统 SHALL 缓存城市和门店数据,提高加载速度。

#### Scenario: 城市列表缓存

- **WHEN** 系统首次加载城市列表
- **THEN** 将数据缓存到本地存储
- **AND** 缓存有效期为1小时
- **AND** 下次打开时优先使用缓存数据

#### Scenario: 缓存失效刷新

- **WHEN** 缓存数据超过有效期
- **THEN** 系统重新请求最新数据
- **AND** 更新缓存

#### Scenario: 手动刷新

- **WHEN** 用户下拉刷新页面
- **THEN** 系统清除缓存
- **AND** 重新加载所有数据


<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ¿è½¦åˆ—è¡¨è·³è½¬æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        button {
            background-color: #409eff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #337ecc;
        }
        pre {
            background-color: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸš æˆ¿è½¦åˆ—è¡¨åŠŸèƒ½æµ‹è¯•</h1>

    <div class="test-section">
        <h2>ğŸ“‹ æµ‹è¯•æ¦‚è¿°</h2>
        <p>æœ¬é¡µé¢ç”¨äºæµ‹è¯•ä»é¦–é¡µé¢„è®¢æ¨¡å—åˆ°æˆ¿è½¦åˆ—è¡¨é¡µçš„å®Œæ•´è·³è½¬æµç¨‹</p>
        <div class="test-result info">
            <strong>ä¿®æ­£å†…å®¹ï¼š</strong>
            <ul>
                <li>âœ… é¦–é¡µhandleSearchå‡½æ•°å·²ä¿®æ­£ä¸ºæ­£ç¡®è·³è½¬åˆ°æˆ¿è½¦åˆ—è¡¨é¡µ</li>
                <li>âœ… åç«¯æˆ¿è½¦åˆ—è¡¨APIå·²å®ç°å¹¶æ­£å¸¸å·¥ä½œ</li>
                <li>âœ… æŸ¥è¯¢å‚æ•°ä¼ é€’æœºåˆ¶å·²å®Œå–„</li>
                <li>âœ… uview-plus CSSå˜é‡å’Œmixiné—®é¢˜å·²ä¿®å¤</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ”§ APIæµ‹è¯•</h2>
        <button onclick="testVehicleListAPI()">æµ‹è¯•æˆ¿è½¦åˆ—è¡¨API</button>
        <button onclick="testActiveVehiclesAPI()">æµ‹è¯•æ´»è·ƒè½¦å‹API</button>
        <div id="api-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“± é¢„è®¢å‚æ•°æµ‹è¯•</h2>
        <p>æ¨¡æ‹Ÿé¦–é¡µé¢„è®¢æ¨¡å—çš„æŸ¥è¯¢å‚æ•°ï¼š</p>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 10px 0;">
            <label>å–è½¦åŸå¸‚ID: <input type="text" id="pickupCityId" value="1"></label>
            <label>å–è½¦é—¨åº—ID: <input type="text" id="pickupStoreId" value="1"></label>
            <label>å–è½¦æ—¶é—´: <input type="datetime-local" id="pickupTime" value="2025-11-01T09:00"></label>
            <label>è¿˜è½¦æ—¶é—´: <input type="datetime-local" id="returnTime" value="2025-11-03T18:00"></label>
        </div>
        <button onclick="testParameterGeneration()">ç”Ÿæˆè·³è½¬URL</button>
        <button onclick="testVehicleListWithParams()">æµ‹è¯•å¸¦å‚æ•°çš„APIè°ƒç”¨</button>
        <div id="param-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š æµ‹è¯•ç»“æœ</h2>
        <div id="test-results">
            <div class="test-result info">
                ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•å„é¡¹åŠŸèƒ½
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';

        function addResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            container.appendChild(div);
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        async function testVehicleListAPI() {
            clearResults('api-results');
            addResult('api-results', 'æ­£åœ¨æµ‹è¯•æˆ¿è½¦åˆ—è¡¨API...', 'info');

            try {
                const response = await fetch(`${API_BASE}/vehicle-models?page=1&pageSize=5&isActive=true&sortBy=comprehensive`);
                const data = await response.json();

                if (data.success) {
                    addResult('api-results', `âœ… APIè°ƒç”¨æˆåŠŸï¼è¿”å›${data.data.list.length}æ¡æˆ¿è½¦æ•°æ®`, 'success');
                    addResult('api-results', `æ€»æ•°é‡: ${data.data.total}`, 'info');

                    // æ˜¾ç¤ºç¬¬ä¸€æ¡æˆ¿è½¦ä¿¡æ¯
                    if (data.data.list.length > 0) {
                        const vehicle = data.data.list[0];
                        addResult('api-results', `ç¤ºä¾‹è½¦å‹: ${vehicle.modelName} - Â¥${vehicle.dailyPrice}/å¤©`, 'info');
                        addResult('api-results', `ç»¼åˆè¯„åˆ†: ${vehicle.comprehensiveScore || 'æœªè®¡ç®—'}`, 'info');
                    }
                } else {
                    addResult('api-results', `âŒ APIè°ƒç”¨å¤±è´¥: ${data.message}`, 'error');
                }
            } catch (error) {
                addResult('api-results', `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function testActiveVehiclesAPI() {
            addResult('api-results', 'æ­£åœ¨æµ‹è¯•æ´»è·ƒè½¦å‹API...', 'info');

            try {
                const response = await fetch(`${API_BASE}/vehicle-models/active`);
                const data = await response.json();

                if (data.success) {
                    addResult('api-results', `âœ… æ´»è·ƒè½¦å‹APIæˆåŠŸï¼è¿”å›${data.data.length}æ¡æ´»è·ƒè½¦å‹`, 'success');
                } else {
                    addResult('api-results', `âŒ æ´»è·ƒè½¦å‹APIå¤±è´¥: ${data.message}`, 'error');
                }
            } catch (error) {
                addResult('api-results', `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }

        function testParameterGeneration() {
            clearResults('param-results');

            const params = {
                pickupCityId: document.getElementById('pickupCityId').value,
                pickupStoreId: document.getElementById('pickupStoreId').value,
                pickupTime: document.getElementById('pickupTime').value,
                returnTime: document.getElementById('returnTime').value
            };

            const queryString = Object.entries(params)
                .map(([key, value]) => `${key}=${encodeURIComponent(String(value))}`)
                .join('&');

            const jumpUrl = `/pages/vehicle-list/index?${queryString}`;

            addResult('param-results', 'ğŸ“‹ ç”Ÿæˆçš„è·³è½¬å‚æ•°ï¼š', 'info');
            addResult('param-results', `<pre>${JSON.stringify(params, null, 2)}</pre>`, 'info');
            addResult('param-results', 'ğŸ”— å°ç¨‹åºè·³è½¬URLï¼š', 'info');
            addResult('param-results', `<pre>${jumpUrl}</pre>`, 'success');
        }

        async function testVehicleListWithParams() {
            clearResults('test-results');
            addResult('test-results', 'æ­£åœ¨æµ‹è¯•å¸¦å‚æ•°çš„æˆ¿è½¦åˆ—è¡¨APIè°ƒç”¨...', 'info');

            const params = {
                page: 1,
                pageSize: 10,
                isActive: true,
                sortBy: 'comprehensive',
                city: document.getElementById('pickupCityId').value
            };

            const queryString = Object.entries(params)
                .filter(([_, value]) => value !== undefined && value !== '')
                .map(([key, value]) => `${key}=${encodeURIComponent(String(value))}`)
                .join('&');

            try {
                const response = await fetch(`${API_BASE}/vehicle-models?${queryString}`);
                const data = await response.json();

                if (data.success) {
                    addResult('test-results', `âœ… å¸¦å‚æ•°çš„APIè°ƒç”¨æˆåŠŸï¼`, 'success');
                    addResult('test-results', `æŸ¥è¯¢å‚æ•°: <pre>${queryString}</pre>`, 'info');
                    addResult('test-results', `è¿”å›ç»“æœ: ${data.data.list.length}æ¡æˆ¿è½¦æ•°æ®`, 'info');

                    // æ˜¾ç¤ºæ¯è¾†è½¦çš„ç»¼åˆè¯„åˆ†
                    data.data.list.forEach((vehicle, index) => {
                        addResult('test-results',
                            `${index + 1}. ${vehicle.modelName} - è¯„åˆ†: ${vehicle.comprehensiveScore || 'æœªè®¡ç®—'} - Â¥${vehicle.dailyPrice}/å¤©`,
                            'info');
                    });
                } else {
                    addResult('test-results', `âŒ APIè°ƒç”¨å¤±è´¥: ${data.message}`, 'error');
                }
            } catch (error) {
                addResult('test-results', `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•åŸºç¡€API
        window.onload = function() {
            addResult('test-results', 'ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•', 'info');
            testVehicleListAPI();
        };
    </script>
</body>
</html>